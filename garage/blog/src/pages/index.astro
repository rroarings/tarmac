---
import BaseHead from "../components/BaseHead.astro";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import DriverCard from "../components/DriverCard.astro";
import RaceCard from "../components/RaceCard.astro";
import { SITE_TITLE, SITE_DESCRIPTION } from "../consts";
import { getCollection } from "astro:content";

const posts = await getCollection("blog");

// Map posts to include slug, title, and heroImage from data
const formattedPosts = posts.map((post) => ({
  slug: post.id,
  title: post.data.title,
  heroImage: post.data.heroImage,
}));

// Limit the formattedPosts array to the latest 3 posts
const latestPosts = formattedPosts.slice(0, 3);

// Get 2025 season drivers
const drivers = await getCollection("drivers", ({ data }) => {
  return data.season === "2025";
});

// Sort drivers by points (highest to lowest) and take top 3
const topDrivers = drivers
  .sort((a, b) => b.data.points - a.data.points)
  .slice(0, 3);

// Get upcoming 2025 races
const races2025 = await getCollection("races", ({ data }) => {
  return data.season === "2025" && data.completed === false;
});

// Sort races by date (earliest first) and take the next 3
const upcomingRaces2025 = races2025
  .sort((a, b) => new Date(a.data.date).getTime() - new Date(b.data.date).getTime())
  .slice(0, 3);

// Get recent 2024 races
const races2024 = await getCollection("races", ({ data }) => {
  return data.season === "2024";
});

// Sort races by date (latest first) and take the most recent 3
const recentRaces2024 = races2024
  .sort((a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime())
  .slice(0, 3);

const features = [
  {
    title: "Driver Profiles",
    description:
      "Explore in-depth profiles of the drivers competing in the FORMULA 1™ championship.",
  },
  {
    title: "Constructor Profiles",
    description:
      "Discover the constructors shaping the FORMULA 1™ grid in the recent seasons.",
  },
  {
    title: "Championship Standings",
    description:
      "Follow the latest driver and constructor standings as the FORMULA 1™ season unfolds.",
  },
  {
    title: "Race Highlights",
    description:
      "Relive key moments and pivotal decisions from recent FORMULA 1™ races.",
  },
  {
    title: "Season Breakdowns",
    description:
      "Analyze team and driver performances across the FORMULA 1™ season with insights and reviews.",
  },
  {
    title: "F1 Technologies",
    description:
      "Trackside covers the cutting-edge technology driving Formula 1's rapid evolution.",
  },
  {
    title: "Past Season Archive",
    description:
      "Travel through the rich history of F1 with a look at the 2023, 2024 and 2025 seasons.",
  },
  {
    title: "Fan Community",
    description:
      "Trackside celebrates the passion and excitement of Formula 1 culture.",
  },
];
---

<!doctype html>
<html lang="en">
  <head>
    <BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
  </head>
  <body>
    <Header />
    <main>
      <!-- About Me Section -->
      <section class="py-5">
        <div class="mx-auto px-4">
          <div
            class="bg-gray-100 border border-gray-300 rounded p-6"
          >
            <div class="flex gap-2 mb-4">
              <i class="bi bi-bookmarks text-4xl text-gray-600 mr-2"></i>
              <div>
                <h1 class="">Trackside Chat</h1>
                <p class="text-gray-600">Trackside's Blog</p>
              </div>
            </div>
            <p class="">
              Welcome to Trackside Chat, your ultimate Formula 1 blog. Here, I
              share insights, analysis, and the latest news from the world of
              Formula 1. Join me as we explore the thrilling world of motorsport
              together!
            </p>
          </div>
        </div>
      </section>

      <!-- Recent Posts Section -->
      <section class="py-5">
        <div class="mx-auto px-4">
          <div
            class="bg-gray-100 border border-gray-300 rounded p-6"
          >
            <div class="flex gap-2 mb-4">
              <i class="bi bi-activity text-4xl text-gray-600 mr-2"></i>
              <div>
                <h2 class="">Recent Posts</h2>
              </div>
            </div>
            <ul class="grid grid-cols-1 md:grid-cols-3 gap-4">
              {
                latestPosts.map((post) => (
                  <li class="bg-white border border-gray-300 rounded overflow-hidden">
                    <a href={`/blog/${post.slug}`} class="block">
                      <img
                        src={post.heroImage || "/public/blog-placeholder-1.jpg"}
                        alt={post.title}
                        class="w-full h-48 object-cover"
                      />
                      <div class="p-4">
                        <h5 class="">{post.title}</h5>
                      </div>
                    </a>
                  </li>
                ))
              }
            </ul>
          </div>
        </div>
      </section>

      <!-- 2025 Drivers Section -->
      <section class="py-5">
        <div class="mx-auto px-4">
          <div
            class="bg-gray-100 border border-gray-300 rounded p-6"
          >
            <div class="flex gap-2 mb-4">
              <i class="bi bi-person-badge text-4xl text-gray-600 mr-2"></i>
              <div>
                <h2 class="">Explore the 2025 Season Drivers</h2>
              </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
              {topDrivers.map((driver) => (
                <DriverCard driver={driver} year="2025" />
              ))}
            </div>
            <div class="mt-8 text-center">
              <a
                href="/seasons/2025/drivers"
                class="bg-red-600 hover:bg-red-700 text-white py-2 px-4 rounded"
              >
                View All 2025 Drivers
              </a>
            </div>
          </div>
        </div>
      </section>

      <!-- Upcoming 2025 Races Section -->
      <section class="py-5">
        <div class="mx-auto px-4">
          <div
            class="bg-gray-100 border border-gray-300 rounded p-6"
          >
            <div class="flex gap-2 mb-4">
              <i class="bi bi-flag-fill text-4xl text-gray-600 mr-2"></i>
              <div>
                <h2 class="">Upcoming 2025 Races</h2>
              </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
              {upcomingRaces2025.map((race) => (
                <RaceCard race={race} />
              ))}
            </div>
            <div class="mt-8 text-center">
              <a
                href="/seasons/2025/races"
                class="bg-red-600 hover:bg-red-700 text-white py-2 px-4 rounded"
              >
                View All 2025 Races
              </a>
            </div>
          </div>
        </div>
      </section>

      <!-- Recent 2024 Races Section -->
      <section class="py-5">
        <div class="mx-auto px-4">
          <div
            class="bg-gray-100 border border-gray-300 rounded p-6"
          >
            <div class="flex gap-2 mb-4">
              <i class="bi bi-trophy-fill text-4xl text-gray-600 mr-2"></i>
              <div>
                <h2 class="">Recent 2024 Races</h2>
              </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
              {recentRaces2024.map((race) => (
                <RaceCard race={race} />
              ))}
            </div>
            <div class="mt-8 text-center">
              <a
                href="/seasons/2024/races"
                class="bg-red-600 hover:bg-red-700 text-white py-2 px-4 rounded"
              >
                View All 2024 Races
              </a>
            </div>
          </div>
        </div>
      </section>
    </main>
    <Footer />
  </body>
</html>
