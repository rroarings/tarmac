---
import BaseHead from "../components/BaseHead.astro";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import { SITE_TITLE, SITE_DESCRIPTION } from "../consts";
import { getCollection } from "astro:content";

const posts = await getCollection("blog");

// Map posts to include slug, title, and heroImage from data
const formattedPosts = posts.map((post) => ({
  slug: post.id,
  title: post.data.title,
  heroImage: post.data.heroImage,
}));

// Limit the formattedPosts array to the latest 3 posts
const latestPosts = formattedPosts.slice(0, 3);
---

<!doctype html>
<html lang="en">
  <head>
    <BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
  </head>
  <body>
    <Header />
    <main>
      <!-- About Me Section -->
      <section class="py-5 text-center">
        <div class="container mx-auto px-4">
          <div
            class="bg-gray-100 border border-gray-300 rounded p-6 inline-block text-left"
          >
            <div class="flex gap-2 mb-4">
              <i class="bi bi-bookmarks text-4xl text-gray-700 mr-4"></i>
              <div>
                <h2 class="">Trackside Chat</h2>
                <p class="text-gray-600">Trackside's Blog</p>
              </div>
            </div>
            <p class="text-gray-700">
              Welcome to Trackside Chat, your ultimate Formula 1 blog. Here, I
              share insights, analysis, and the latest news from the world of
              Formula 1. Join me as we explore the thrilling world of motorsport
              together!
            </p>
          </div>
        </div>
      </section>

      <!-- Recent Posts Section -->
      <section class="py-5 text-center">
        <div class="container mx-auto px-4">
          <div
            class="bg-gray-100 border border-gray-300 rounded p-6 inline-block text-left"
          >
            <div class="flex gap-2 mb-4">
              <i class="bi bi-activity text-4xl text-gray-700 mr-4"></i>
              <div>
                <h2 class="">Recent Posts</h2>
              </div>
            </div>
            <ul class="grid grid-cols-1 md:grid-cols-3 gap-4">
              {latestPosts.map((post) => (
                <li class="bg-white border border-gray-300 rounded overflow-hidden">
                  <a href={`/blog/${post.slug}`} class="block">
                    <img src={post.heroImage || '/public/blog-placeholder-1.jpg'} alt={post.title} class="w-full h-48 object-cover" />
                    <div class="p-4">
                      <h5 class="">{post.title}</h5>
                    </div>
                  </a>
                </li>
              ))}
            </ul>
          </div>
        </div>
      </section>
    </main>
    <Footer />
  </body>
</html>
