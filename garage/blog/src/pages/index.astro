---
import BaseHead from "../components/BaseHead.astro";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import DriverCard from "../components/DriverCard.astro";
import RaceCard from "../components/RaceCard.astro";
import BreakpointIndicator from "../components/BreakpointIndicator.astro";
import { SITE_TITLE, SITE_DESCRIPTION } from "../consts";
import { getCollection } from "astro:content";

const posts = await getCollection("blog");

// Map posts to include slug, title, and heroImage from data
const formattedPosts = posts.map((post) => ({
  slug: post.id,
  title: post.data.title,
  heroImage: post.data.heroImage,
}));

// Limit the formattedPosts array to the latest 3 posts
const latestPosts = formattedPosts.slice(0, 3);

// Get 2025 season drivers
const drivers = await getCollection("drivers", ({ data }) => {
  return data.season === "2025";
});

// Sort drivers by points (highest to lowest)
const sortedDrivers = drivers.sort((a, b) => b.data.points - a.data.points);

// Get top 3 drivers for the grid section
const topDrivers = sortedDrivers.slice(0, 3);

// Get 2025 season teams
const teams = await getCollection("teams", ({ data }) => {
  return data.season === "2025";
});

// Sort teams by constructor points
const sortedTeams = teams.sort(
  (a, b) => b.data.constructorPoints - a.data.constructorPoints,
);

// Get upcoming 2025 races
const races2025 = await getCollection("races", ({ data }) => {
  return data.season === "2025" && data.completed === false;
});

// Sort races by date (earliest first) and take the next 3
const upcomingRaces2025 = races2025
  .sort(
    (a, b) => new Date(a.data.date).getTime() - new Date(b.data.date).getTime(),
  )
  .slice(0, 3);

const features = [
  {
    title: "Driver Profiles",
    description:
      "Explore in-depth profiles of the drivers competing in the FORMULA 1™ championship.",
  },
  {
    title: "Constructor Profiles",
    description:
      "Discover the constructors shaping the FORMULA 1™ grid in the recent seasons.",
  },
  {
    title: "Championship Standings",
    description:
      "Follow the latest driver and constructor standings as the FORMULA 1™ season unfolds.",
  },
  {
    title: "Race Highlights",
    description:
      "Relive key moments and pivotal decisions from recent FORMULA 1™ races.",
  },
  {
    title: "Season Breakdowns",
    description:
      "Analyze team and driver performances across the FORMULA 1™ season with insights and reviews.",
  },
  {
    title: "F1 Technologies",
    description:
      "Trackside covers the cutting-edge technology driving Formula 1's rapid evolution.",
  },
  {
    title: "Past Season Archive",
    description:
      "Travel through the rich history of F1 with a look at the 2023, 2024 and 2025 seasons.",
  },
  {
    title: "Fan Community",
    description:
      "Trackside celebrates the passion and excitement of Formula 1 culture.",
  },
];
---

<!doctype html>
<html lang="en">
  <head>
    <BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
  </head>
  <body>
    <BreakpointIndicator />
    <Header />
    <main>
      <!-- About Me Section -->
      <section class="py-5">
        <div class="p-6">
          <header class="flex items-center gap-3 mb-4">
            <div>
              <h1 class="text-2xl font-bold">Trackside</h1>
            </div>
          </header>
          <p class="text-gray-700">
            Welcome to Trackside Chat, your ultimate Formula 1 blog. Here, I
            share insights, analysis, and the latest news from the world of
            Formula 1. Join me as we explore the thrilling world of motorsport
            together!
          </p>
        </div>
      </section>

       <!-- 2025 Highlights Section -->
      <TwoColumnSection
        title="2025 Highlights"
        description="Dive into the most exciting moments of the 2025 Formula 1 season. Explore race highlights, dramatic overtakes, and pivotal decisions that shaped the championship. Watch exclusive clips and read in-depth breakdowns of key races and driver performances."
        ctaText="Explore 2025 Clips & Breakdowns"
        ctaLink="/seasons/2025"
        background="gray"
      />

       <!-- Features Grid Section -->
      <FeatureGrid
        title="What Trackside is about"
        features={features}
        columns={2}
      />

      <!-- Championship Standings Section -->

      <!-- 2025 Drivers Section -->
      <section class="py-5">
        <div class="mx-auto px-4">
          <div class="p-6">
            <header class="flex items-center gap-3 mb-6">
              <h2 class="text-2xl font-bold">
                Explore the 2025 Season Drivers
              </h2>
            </header>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
              {
                topDrivers.map((driver) => (
                  <DriverCard driver={driver} year="2025" />
                ))
              }
            </div>
            <div class="mt-8 text-center">
              <a
                href="/seasons/2025/drivers"
                class="bg-red-600 hover:bg-red-700 text-white py-2 px-4 rounded"
              >
                View All 2025 Drivers
              </a>
            </div>
          </div>
        </div>
      </section>

      <!-- Upcoming 2025 Races Section -->
      <section class="py-5">
        <div class="mx-auto px-4">
          <div class="p-6">
            <header class="flex items-center gap-3 mb-6">
              <h2 class="text-2xl font-bold">Upcoming 2025 Races</h2>
            </header>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
              {upcomingRaces2025.map((race) => <RaceCard race={race} />)}
            </div>
            <div class="mt-8 text-center">
              <a
                href="/seasons/2025/races"
                class="bg-red-600 hover:bg-red-700 text-white py-2 px-4 rounded"
              >
                View All 2025 Races
              </a>
            </div>
          </div>
        </div>
      </section>

      <!-- Recent Posts Section -->
      <section class="py-5">
        <div class="mx-auto px-4">
          <div class="p-6">
            <header class="flex items-center gap-3 mb-6">
              <h2 class="text-2xl font-bold">Recent Posts</h2>
            </header>
            <ul class="grid grid-cols-1 md:grid-cols-3 gap-4">
              {
                latestPosts.map((post) => (
                  <li class="bg-white border border-gray-300 rounded overflow-hidden">
                    <a href={`/blog/${post.slug}`} class="block">
                      <img
                        src={post.heroImage || "/public/blog-placeholder-1.jpg"}
                        alt={post.title}
                        class="w-full h-48 object-cover"
                      />
                      <div class="p-4">
                        <h5 class="">{post.title}</h5>
                      </div>
                    </a>
                  </li>
                ))
              }
            </ul>
          </div>
        </div>
      </section>
    </main>
    <Footer />
  </body>
</html>
